<div class="admin-panel">
  <div class="admin-header">
    <h1>Admin Paneli</h1>
  </div>

  <div class="admin-tabs">
    <button 
      [class.active]="activeTab() === 'dashboard'" 
      (click)="switchTab('dashboard')">
      ğŸ“Š Dashboard
    </button>
    <button 
      [class.active]="activeTab() === 'users'" 
      (click)="switchTab('users')">
      ğŸ‘¥ KullanÄ±cÄ±lar
    </button>
    <button 
      [class.active]="activeTab() === 'rooms'" 
      (click)="switchTab('rooms')">
      ğŸšª Odalar
    </button>
    <button 
      [class.active]="activeTab() === 'equipment'" 
      (click)="switchTab('equipment')">
      ğŸ’» Ekipmanlar
    </button>
    <button 
      [class.active]="activeTab() === 'reservations'" 
      (click)="switchTab('reservations')"
      class="tab-button-with-badge">
      ğŸ“… Bekleyen Rezervasyonlar
      @if (hasPendingReservations) {
        <span class="notification-badge"></span>
      }
    </button>
    <button 
      [class.active]="activeTab() === 'all-reservations'" 
      (click)="switchTab('all-reservations')">
      ğŸ“‹ TÃ¼m Rezervasyonlar
    </button>
    <button 
      [class.active]="activeTab() === 'sql-console'" 
      (click)="switchTab('sql-console')">
      ğŸ—„ï¸ SQL Konsol
    </button>
  </div>

  @if (error()) {
    <div class="error-message">{{ error() }}</div>
  }

  @if (loading()) {
    <div class="loading">YÃ¼kleniyor...</div>
  }

  <!-- Dashboard Tab -->
  @if (activeTab() === 'dashboard' && stats()) {
    <div class="dashboard-stats">
      <div class="stat-card">
        <h3>ğŸ‘¥ KullanÄ±cÄ±lar</h3>
        <p class="stat-number">{{ stats()!.totalUsers }}</p>
        <p class="stat-detail">{{ stats()!.totalAdmins }} Admin | {{ stats()!.totalRegularUsers }} KullanÄ±cÄ±</p>
      </div>

      <div class="stat-card">
        <h3>ğŸšª Odalar</h3>
        <p class="stat-number">{{ stats()!.totalRooms }}</p>
        <p class="stat-detail">{{ stats()!.emptyRooms }} BoÅŸ | {{ stats()!.occupiedRooms }} Dolu | {{ stats()!.maintenanceRooms }} BakÄ±mda</p>
      </div>

      <div class="stat-card">
        <h3>ğŸ’» Ekipmanlar</h3>
        <p class="stat-number">{{ stats()!.totalEquipment }}</p>
        <p class="stat-detail">{{ stats()!.availableEquipment }} MÃ¼sait | {{ stats()!.reservedEquipment }} Rezerveli</p>
      </div>

      <div class="stat-card">
        <h3>ğŸ“… Rezervasyonlar</h3>
        <p class="stat-number">{{ stats()!.totalReservations }}</p>
        <p class="stat-detail">{{ stats()!.pendingReservations }} Bekleyen</p>
      </div>

      <div class="stat-card">
        <h3>â° Zaman Dilimleri</h3>
        <p class="stat-number">{{ stats()!.totalTimeSlots }}</p>
      </div>
    </div>
  }

  <!-- Users Tab -->
  @if (activeTab() === 'users') {
    <div class="tab-content">
      <div class="tab-header">
        <h2>KullanÄ±cÄ± YÃ¶netimi</h2>
        <button class="btn-primary" (click)="showCreateAdminModal.set(true)">
          â• Yeni KullanÄ±cÄ± Ekle
        </button>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ä°sim</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Ä°ÅŸlemler</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users(); track user.userId) {
            <tr>
              <td>{{ user.userId }}</td>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td>
                <span [class]="user.role === 'ADMIN' ? 'badge-admin' : 'badge-user'">
                  {{ user.role }}
                </span>
              </td>
              <td class="action-buttons">
                @if (user.role === 'USER') {
                  <button class="btn-small" (click)="promoteToAdmin(user.userId)">
                    ğŸ‘‘ Admin Yap
                  </button>
                }
                <button class="btn-small btn-danger" (click)="deleteUser(user.userId)">
                  ğŸ—‘ï¸ Sil
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Rooms Tab -->
  @if (activeTab() === 'rooms') {
    <div class="tab-content">
      <div class="tab-header">
        <h2>Oda YÃ¶netimi</h2>
        <button class="btn btn-primary" (click)="openCreateRoomModal()">
          â• Yeni Oda Ekle
        </button>
      </div>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Oda AdÄ±</th>
            <th>Kapasite</th>
            <th>Durum</th>
            <th>Ä°ÅŸlemler</th>
          </tr>
        </thead>
        <tbody>
          @for (room of rooms(); track room.roomId) {
            <tr>
              <td>{{ room.roomId }}</td>
              <td>{{ room.name }}</td>
              <td>{{ room.capacity }} kiÅŸi</td>
              <td>
                <span [class]="'badge-' + room.status.toLowerCase()">
                  {{ getRoomStatusText(room.status) }}
                </span>
              </td>
              <td class="action-buttons">
                <button class="btn-edit" (click)="openEditRoomModal(room)">âœï¸ DÃ¼zenle</button>
                <button class="btn-delete" (click)="deleteRoom(room.roomId)">ğŸ—‘ï¸ Sil</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Equipment Tab -->
  @if (activeTab() === 'equipment') {
    <div class="tab-content">
      <div class="tab-header">
        <h2>Ekipman YÃ¶netimi</h2>
        <button class="btn btn-primary" (click)="openCreateEquipmentModal()">
          â• Yeni Ekipman Ekle
        </button>
      </div>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ekipman AdÄ±</th>
            <th>TÃ¼r</th>
            <th>Durum</th>
            <th>Ä°ÅŸlemler</th>
          </tr>
        </thead>
        <tbody>
          @for (equip of equipment(); track equip.equipmentId) {
            <tr>
              <td>{{ equip.equipmentId }}</td>
              <td>{{ equip.name }}</td>
              <td>{{ equip.type }}</td>
              <td>
                <span [class]="'badge-' + equip.status.toLowerCase()">
                  {{ getEquipmentStatusText(equip.status) }}
                </span>
              </td>
              <td class="action-buttons">
                <button class="btn-edit" (click)="openEditEquipmentModal(equip)">âœï¸ DÃ¼zenle</button>
                <button class="btn-delete" (click)="deleteEquipment(equip.equipmentId)">ğŸ—‘ï¸ Sil</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Pending Reservations Tab -->
  @if (activeTab() === 'reservations') {
    <div class="tab-content">
      <h2>Bekleyen Rezervasyonlar</h2>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>KullanÄ±cÄ±</th>
            <th>Oda/Ekipman</th>
            <th>Tarih</th>
            <th>Saat</th>
            <th>Ä°ÅŸlem</th>
          </tr>
        </thead>
        <tbody>
          @for (res of pendingReservations(); track res.reservationId) {
            <tr>
              <td>{{ res.reservationId }}</td>
              <td>{{ res.user.name }}</td>
              <td>{{ res.room?.name || res.equipment?.name }}</td>
              <td>{{ res.reservationDate }}</td>
              <td>{{ res.timeSlot.startTime }} - {{ res.timeSlot.endTime }}</td>
              <td class="action-buttons">
                <button class="btn-success" (click)="confirmReservation(res.reservationId)">
                  Onayla
                </button>
                <button class="btn-danger" (click)="cancelReservation(res.reservationId)">
                  Reddet
                </button>
              </td>
            </tr>
          }
          @empty {
            <tr>
              <td colspan="6" class="text-center">Bekleyen rezervasyon yok</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- All Reservations Tab -->
  @if (activeTab() === 'all-reservations') {
    <div class="tab-content">
      <h2>TÃ¼m Rezervasyonlar</h2>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>KullanÄ±cÄ±</th>
            <th>Oda/Ekipman</th>
            <th>Tarih</th>
            <th>Saat</th>
            <th>Durum</th>
            <th>Ä°ÅŸlem</th>
          </tr>
        </thead>
        <tbody>
          @for (res of allReservations(); track res.reservationId) {
            <tr>
              <td>{{ res.reservationId }}</td>
              <td>{{ res.user.name }}</td>
              <td>{{ res.room?.name || res.equipment?.name }}</td>
              <td>{{ res.reservationDate }}</td>
              <td>{{ res.timeSlot.startTime }} - {{ res.timeSlot.endTime }}</td>
              <td>
                <span [class]="'badge-status-' + res.status.toLowerCase()">
                  {{ res.status }}
                </span>
              </td>
              <td class="action-buttons">
                @if (res.status === 'BEKLENIYOR') {
                  <button class="btn-success" (click)="confirmReservation(res.reservationId)">
                    âœ… Onayla
                  </button>
                }
                @if (res.status !== 'IPTAL_EDILDI') {
                  <button class="btn-danger" (click)="cancelReservation(res.reservationId)">
                    âŒ Ä°ptal Et
                  </button>
                }
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="7" class="text-center">Rezervasyon bulunamadÄ±</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Create Admin Modal -->
  @if (showCreateAdminModal()) {
    <div class="modal-overlay" (click)="showCreateAdminModal.set(false)">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Yeni KullanÄ±cÄ± OluÅŸtur</h2>
        
        <form (ngSubmit)="createUser()">
          <div class="form-group">
            <label>Ä°sim</label>
            <input type="text" [(ngModel)]="newAdmin.name" name="name" required>
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="newAdmin.email" name="email" required>
          </div>

          <div class="form-group">
            <label>Åifre</label>
            <input type="password" [(ngModel)]="newAdmin.password" name="password" required>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="showCreateAdminModal.set(false)">
              Ä°ptal
            </button>
            <button type="submit" class="btn-primary">
              OluÅŸtur
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Create/Edit Room Modal -->
  @if (showCreateRoomModal()) {
    <div class="modal-overlay" (click)="showCreateRoomModal.set(false)">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>{{ editingRoom ? 'Oda DÃ¼zenle' : 'Yeni Oda Ekle' }}</h2>
        
        <form (ngSubmit)="saveRoom()">
          <div class="form-group">
            <label>Oda AdÄ±</label>
            <input type="text" [(ngModel)]="newRoom.name" name="name" required placeholder="Ã–rn: ToplantÄ± OdasÄ± A">
          </div>

          <div class="form-group">
            <label>Kapasite</label>
            <input type="number" [(ngModel)]="newRoom.capacity" name="capacity" min="1" required>
          </div>

          <div class="form-group">
            <label>Durum</label>
            <select [(ngModel)]="newRoom.status" name="status" required>
              <option value="EMPTY">BoÅŸ</option>
              <option value="OCCUPIED">Dolu</option>
              <option value="MAINTENANCE">BakÄ±mda</option>
            </select>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="showCreateRoomModal.set(false)">
              Ä°ptal
            </button>
            <button type="submit" class="btn-primary">
              {{ editingRoom ? 'GÃ¼ncelle' : 'Ekle' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Create/Edit Equipment Modal -->
  @if (showCreateEquipmentModal()) {
    <div class="modal-overlay" (click)="showCreateEquipmentModal.set(false)">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>{{ editingEquipment ? 'Ekipman DÃ¼zenle' : 'Yeni Ekipman Ekle' }}</h2>
        
        <form (ngSubmit)="saveEquipment()">
          <div class="form-group">
            <label>Ekipman AdÄ±</label>
            <input type="text" [(ngModel)]="newEquipment.name" name="name" required placeholder="Ã–rn: Dell Laptop #001">
          </div>

          <div class="form-group">
            <label>TÃ¼r</label>
            <select [(ngModel)]="newEquipment.type" name="type" required>
              <option value="">TÃ¼r seÃ§iniz</option>
              <option *ngFor="let type of equipmentTypes" [value]="type">{{ type }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Durum</label>
            <select [(ngModel)]="newEquipment.status" name="status" required>
              <option value="AVAILABLE">MÃ¼sait</option>
              <option value="RESERVED">Rezerveli</option>
              <option value="MAINTENANCE">BakÄ±mda</option>
            </select>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="showCreateEquipmentModal.set(false)">
              Ä°ptal
            </button>
            <button type="submit" class="btn-primary">
              {{ editingEquipment ? 'GÃ¼ncelle' : 'Ekle' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- SQL Console Tab -->
  @if (activeTab() === 'sql-console') {
    <app-sql-console></app-sql-console>
  }
</div>